import random
import logging
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# ‚ö†Ô∏è ‡∂î‡∂∂‡∂ú‡∑ö Telegram Bot Token ‡∂ë‡∂ö ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±! ‚ö†Ô∏è
# ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∑É‡∂≥‡∑Ñ‡∑è, ‡∂∏‡∑ô‡∂∫ Replit Secrets (‡∂¥‡∂ª‡∑í‡∑É‡∂ª ‡∑Ä‡∑í‡∂†‡∂Ω‡∑ä‚Äç‡∂∫) ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏ ‡∑Ä‡∂©‡∑è‡∂≠‡∑ä ‡∑É‡∑î‡∂Ø‡∑î‡∑É‡∑î‡∂∫.
TELEGRAM_BOT_TOKEN = "8382727460:AAEgKVISJN5TTuV4O-82sMGQDG3khwjiKR8" 

# Console ‡∑Ñ‡∑í Log ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# --- Luhn Algorithm ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑ì‡∂≠‡∑ä‡∑Ä‡∂∫ ---

def calculate_luhn_checksum(digits: str) -> int:
    """ Luhn Algorithm ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∂ö ‡∂Ö‡∂Ç‡∂ö‡∂∫ (checksum) ‡∂ú‡∂´‡∂±‡∂∫ ‡∂ö‡∂ª‡∂∫‡∑í. """
    
    # ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∑Ñ‡∑ê‡∂ª ‡∂Ö‡∂±‡∑ô‡∂ö‡∑î‡∂≠‡∑ä ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏‡∑ä ‡∂ú‡∂±‡∑ä‡∂±
    # Luhn ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∂Ø‡∂ö‡∑î‡∂´‡∑ö ‡∑É‡∑í‡∂ß ‡∂¥‡∑Ö‡∂∏‡∑î ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂Ω‡∑ô‡∑É ‡∂ú‡∂´‡∂±‡∑ä ‡∂ú‡∂±‡∑ì.
    # ‡∂Ö‡∂¥‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∂¥‡∑è‡∂Ω‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂Ω‡∑ô‡∑É ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß‡∂∫‡∑í.
    
    # ‡∂Ö‡∂¥‡∑í ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∂á‡∂≠‡∑î‡∑Ö‡∑î‡∑Ä ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∂∏‡∑ä,
    # ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∑ô‡∑Ñ‡∑í ‡∂Ö‡∂ú‡∂∫ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∂≠.
    # ‡∂∏‡∑ô‡∑Ñ‡∑í‡∂Ø‡∑ì ‡∂Ö‡∂¥‡∑í ‡∂ë‡∂∫ 0 ‡∂Ω‡∑ô‡∑É ‡∑É‡∂Ω‡∂ö‡∂∏‡∑î.
    reversed_digits = [int(d) for d in digits][::-1]
    total_sum = 0
    
    # ‡∂Ø‡∂ö‡∑î‡∂´‡∑ö ‡∑É‡∑í‡∂ß ‡∂¥‡∑Ö‡∂∏‡∑î ‡∂Ö‡∂Ç‡∂ö‡∂∫ (‡∂¥‡∑è‡∂Ω‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫) ‡∑Ñ‡∑ê‡∂ª‡∑ô‡∂±‡∑ä‡∂±‡∂ß
    for i, digit in enumerate(reversed_digits):
        # ‡∂Ø‡∂ö‡∑î‡∂´‡∑ö ‡∑É‡∑í‡∂ß ‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ (i=1), ‡∑Ñ‡∂≠‡∂ª‡∑Ä‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ (i=3) ‡∂Ü‡∂Ø‡∑í‡∂∫ ‡∂Ø‡∑ô‡∂ú‡∑î‡∂´ ‡∂ö‡∂ª‡∂∫‡∑í
        if i % 2 == 1: 
            doubled = digit * 2
            if doubled > 9:
                doubled -= 9
            total_sum += doubled
        else:
            total_sum += digit
            
    # Luhn Formula ‡∑Ñ‡∑í ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂¥‡∑è‡∂Ω‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂ú‡∂´‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
    # (total_sum + check_digit) % 10 == 0 ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫.
    checksum = (10 - (total_sum % 10)) % 10
    return checksum

def generate_luhn_valid_number(length: int = 16) -> str:
    """ Luhn Algorithm ‡∂Ö‡∂±‡∑î‡∑Ä ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂´‡∂∫‡∂¥‡∂≠‡∑ä ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑ä ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∂ª‡∂∫‡∑í. """
    
    # ‡∂´‡∂∫‡∂¥‡∂≠‡∑ä ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í‡∂∫‡∂ß ‡∂Ö‡∂±‡∑î‡∑Ä 4 (VISA) ‡∑Ñ‡∑ù 5 (Mastercard) ‡∑Ä‡∑ê‡∂±‡∑í ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑í‡∂±‡∑ä ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    first_digit = random.choice(['4', '5'])
    
    # ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∑Ñ‡∑ê‡∂ª ‡∂â‡∂≠‡∑í‡∂ª‡∑í ‡∂Ö‡∑Ñ‡∂π‡∑î ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏‡∑ä ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
    base_number_prefix = first_digit + ''.join([str(random.randint(0, 9)) for _ in range(length - 1)])

    # ‡∂¥‡∑è‡∂Ω‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂ú‡∂´‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
    # calculate_luhn_checksum ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∏ ‡∂Ω‡∑ô‡∑É 0 ‡∑É‡∂Ω‡∂ö‡∂∏‡∑í‡∂±‡∑ä ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è ‡∂ö‡∂ª‡∂∫‡∑í.
    check_digit = calculate_luhn_checksum(base_number_prefix + '0')

    # ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ Luhn ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∑É‡∑ë‡∂Ø‡∑ì‡∂∏
    final_number = base_number_prefix[:-1] + str(check_digit)
    
    return final_number

# --- Telegram Bot ‡∑Ä‡∑í‡∂∞‡∑è‡∂± (Commands) ---

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """ /start ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª ‡∂Ø‡∂ö‡∑ä‡∑Ä‡∂∫‡∑í. """
    await update.message.reply_text(
        'üëã *‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä!* üí≥\n\n'
        '‡∂∏‡∂∏ Luhn Algorithm ‡∂Ö‡∂±‡∑î‡∑Ä *‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í‡∂ú‡∂≠‡∑Ä ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î* ‡∂´‡∂∫‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∂ª‡∂± Bot ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä.\n'
        '‡∑É‡∑ê‡∂∂‡∑ë ‡∂ú‡∂±‡∑î‡∂Ø‡∑ô‡∂±‡∑î ‡∑É‡∂≥‡∑Ñ‡∑è *‡∑É‡∂¢‡∑ì‡∑Ä‡∑ì ‡∂ö‡∑è‡∂©‡∑ä‡∂¥‡∂≠‡∑ä* ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∑Ñ‡∑ê‡∂ö‡∑í‡∂∫‡∑è‡∑Ä ‡∂∏‡∑è ‡∑É‡∂≠‡∑î‡∑Ä ‡∂±‡∑ê‡∂≠.\n\n'
        '‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑ä ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß: */generate*',
        parse_mode='Markdown'
    )

async def generate_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """ /generate ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª ‡∂Ø‡∂ö‡∑ä‡∑Ä‡∑è Luhn ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑ä ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∂ª‡∂∫‡∑í. """
    try:
        # Luhn ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
        cc_format = generate_luhn_valid_number(length=16)
        
        # ‡∂ö‡∑í‡∂∫‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂¥‡∑Ñ‡∑É‡∑î ‡∑Ä‡∂± ‡∂Ω‡∑ô‡∑É ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
        formatted_cc = ' '.join([cc_format[i:i+4] for i in range(0, 16, 4)])
        
        # ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª‡∂∫
        response_text = (
            f"‚úÖ *Luhn ‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂¢‡∂±‡∂±‡∂∫ ‡∑Ä‡∑í‡∂∫:* \n\n"
            f"`{formatted_cc}`\n\n"
            f"_‚ö†Ô∏è ‡∂∏‡∑ô‡∂∫ ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂¥‡∂∏‡∂´‡∑í. ‡∂∏‡∑ô‡∂∫ ‡∑É‡∂¢‡∑ì‡∑Ä‡∑ì ‡∂ú‡∂±‡∑î‡∂Ø‡∑ô‡∂±‡∑î ‡∂ö‡∑è‡∂©‡∑ä‡∂¥‡∂≠‡∂ö‡∑ä ‡∂±‡∑ú‡∑Ä‡∑ö._"
        )
        await update.message.reply_text(response_text, parse_mode='Markdown')
        
    except Exception as e:
        logger.error(f"Error during generation: {e}")
        await update.message.reply_text("‡∂Ö‡∂Ç‡∂ö ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∑í‡∂∫.")


def main() -> None:
    """ Bot ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫. """
    
    if TELEGRAM_BOT_TOKEN == "‡∂î‡∂∂‡∑ö_‡∑É‡∂≠‡∑ä‚Äç‡∂∫_BOT_TOKEN_‡∂ë‡∂ö_‡∂∏‡∑ô‡∑Ñ‡∑í_‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä_‡∂ö‡∂ª‡∂±‡∑ä‡∂±":
        logger.error("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª TELEGRAM_BOT_TOKEN ‡∑Ä‡∑í‡∂†‡∂Ω‡∑ä‚Äç‡∂∫‡∂∫‡∂ß ‡∂î‡∂∂‡∂ú‡∑ö ‡∑É‡∂≠‡∑ä‚Äç‡∂∫ Bot Token ‡∂ë‡∂ö ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.")
        return

    # Application ‡∂ë‡∂ö ‡∑É‡∑è‡∂Ø‡∂±‡∑ä‡∂±
    application = Application.builder().token(TELEGRAM_BOT_TOKEN).build()

    # ‡∑Ä‡∑í‡∂∞‡∑è‡∂± ‡∑É‡∂≥‡∑Ñ‡∑è Handlers ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("generate", generate_command))

    # Bot ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ (Replit ‡∑É‡∂≥‡∑Ñ‡∑è Polling)
    logger.info("Bot ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∑Ä‡∑í‡∂∫...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == '__main__':
    main()
